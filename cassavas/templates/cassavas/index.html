<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Farmers Aid - Cassava Disease Detection</title>
<style>
    body {
        font-family: 'Roboto', sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 0;
    }
    header {
        background-color: #28a745;
        color: white;
        padding: 1rem 0;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 2rem 1rem;
    }
    .content-section, .upload-container {
        background-color: white;
        padding: 2rem;
        margin: 1rem 0;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        width: 100%;
        max-width: 600px;
        text-align: center;
    }
    .content-section h2, .upload-container h2 {
        color: #333;
        margin-bottom: 1rem;
    }
    .content-section p {
        color: #666;
        line-height: 1.6;
    }
    button {
        background-color: #28a745;
        color: white;
        padding: 0.7rem 1.5rem;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
    }
    button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
    }
    #image-preview {
        display: none;
        max-width: 100%;
        margin-top: 1rem;
    }
    footer {
        background-color: #28a745;
        color: white;
        text-align: center;
        padding: 1rem;
        position: fixed;
        width: 100%;
        bottom: 0;
    }
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
    }
    .modal-content {
        background-color: white;
        margin: 15% auto;
        padding: 2rem;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
        text-align: center;
        border-radius: 5px;
    }
    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        margin-right: -1rem;
        margin-top: -1rem;
    }
    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
    .modal-btn {
        display: block;
        width: 100%;
        background-color: #28a745;
        color: white;
        padding: 0.5rem;
        border: none;
        border-radius: 5px;
        margin-top: 1rem;
        cursor: pointer;
        font-size: 1rem;
    }
</style>
</head>
<body>
    <header>
        <h1>Farmers Aid - Cassava Disease Detection</h1>
    </header>
    <div class="container">
        <section class="content-section">
            <h2>Empowering Farmers with AI</h2>
            <p>Welcome to Farmers Aid, where we use AI to detect diseases in cassava plants, helping farmers identify and treat infected plants early.</p>
            <p>Upload an image of a cassava leaf to get started.</p>
        </section>
        <div class="upload-container">
            <h2>Upload Cassava Image</h2>
            <form id="image-form" enctype="multipart/form-data" action="{% url 'predict' %}" method="POST">
                {% csrf_token %}
                <input type="file" id="file-input" name="cassava_image" accept="image/*" style="display: none;" onchange="previewImage(event)">
                <button type="button" id="choose-image-btn" onclick="openModal()">Choose Image</button>
                <br>
                <img id="image-preview" src="" alt="">
                <br>
                <button type="submit" id="upload" disabled>Upload</button>
            </form>
        </div>
    </div>
    <footer>
        <p>&copy; 2024 Farmers Aid. All rights reserved.</p>
    </footer>

    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <button class="modal-btn" onclick="chooseUpload()">Upload</button>
            <button class="modal-btn" onclick="startCamera()">Take Photo</button>
        </div>
    </div>

    <video id="video-preview" style="display: none;"></video>

    <script>
        let stream;
        let videoTracks;

        function previewImage(event) {
            var imageElement = document.getElementById('image-preview');
            if (event.target.files && event.target.files[0]) {
                imageElement.src = URL.createObjectURL(event.target.files[0]);
                imageElement.style.display = 'block';
                document.getElementById('upload').removeAttribute('disabled');
            }
        }
        
        function openModal() {
            var modal = document.getElementById('myModal');
            modal.style.display = 'block';
        }

        function closeModal() {
            var modal = document.getElementById('myModal');
            modal.style.display = 'none';
            stopCamera();
        }

        function chooseUpload() {
            document.getElementById('file-input').click();
            closeModal();
        }

        async function takePhoto() {
            const video = document.getElementById('video-preview');
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            const imageData = canvas.toDataURL('image/jpeg');

            document.getElementById('image-preview').src = imageData;
            document.getElementById('image-preview').style.display = 'block';
            document.getElementById('upload').removeAttribute('disabled');

            stopCamera();
        }

        async function startCamera() {
            stream = await navigator.mediaDevices.getUserMedia({ video: true });
            videoTracks = stream.getVideoTracks();
            const video = document.getElementById('video-preview');
            video.srcObject = stream;
            video.style.display = 'block';
            video.play();
        }

        function stopCamera() {
            if (videoTracks) {
                videoTracks.forEach(track => track.stop());
            }
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            document.getElementById('video-preview').style.display = 'none';
        }
    </script>
</body>
</html>
